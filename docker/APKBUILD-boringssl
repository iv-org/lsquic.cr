# Based on https://aur.archlinux.org/packages/boringssl-git/
# Maintainer: Omar Roth <omarroth@protonmail.com>
pkgname=boringssl
pkgver=1.1.0
pkgrel=0
pkgdesc="BoringSSL is a fork of OpenSSL that is designed to meet Google's needs"
url="https://boringssl.googlesource.com/boringssl"
arch="all"
license="MIT"
replaces="openssl libressl"
depends="!openssl-libs-static"
makedepends_host="linux-headers"
makedepends="cmake git go perl"
subpackages="$pkgname-static $pkgname-dev $pkgname-doc"
source="c239ffd.tar.gz::https://github.com/google/boringssl/tarball/c239ffd"
builddir="$srcdir/google-boringssl-c239ffd"

prepare() {
	:
}

build() {
	cmake -DCMAKE_BUILD_TYPE=Debug .
	make ssl crypto
}

check() {
	make all_tests
}

package() {
	for i in *.md ; do
		install -Dm644 $i "$pkgdir/usr/share/doc/$pkgname/$i"
	done
	install -d "$pkgdir/usr/lib"
	install -d "$pkgdir/usr/include"
	cp -R include/openssl "$pkgdir/usr/include"

	install -Dm755 crypto/libcrypto.a "$pkgdir/usr/lib/libcrypto.a"
	install -Dm755 ssl/libssl.a "$pkgdir/usr/lib/libssl.a"
#	install -Dm755 decrepit/libdecrepit.a "$pkgdir/usr/lib/libdecrepit.a"
#	install -Dm755 libboringssl_gtest.a "$pkgdir/usr/lib/libboringssl_gtest.a"
}
sha512sums="fad2e914fdefeaa4ef0add297a214cbecac9f1290f8a3aa63df97890ab7d4cb569183a140b6d9216c719a857c163705df7f1721e956a9b0355117a5eef58d469  c239ffd.tar.gz"
